<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kulaun Naya Bank - Professional Banking</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* 1. The Master Design System */
        :root {
            --primary-color: #0A2463; /* Dark Blue */
            --secondary-color: #FF8C42; /* Bright Orange */
            --tertiary-color: #20BF55; /* Vibrant Green */
            --error-color: #D90429; /* Strong Red for Errors */
            --background-color: #F7F9FB; /* Light Grey Blue */
            --text-color: #333333; /* Dark Grey */
            --white-color: #FFFFFF;
            --light-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --dark-shadow: 0 8px 25px rgba(10, 36, 99, 0.15);
            --gradient-primary: linear-gradient(45deg, #FF8C42, #FFC042); /* Orange to Yellow */
            --gradient-secondary: linear-gradient(45deg, #0A2463, #1A4D90); /* Dark Blue to Lighter Blue */
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden; /* Prevent horizontal scroll from animations */
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background-color: var(--background-color);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 25px rgba(0,0,0,0.1); /* Subtle container shadow */
            overflow-x: hidden;
        }

        .screen {
            display: none;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            min-height: 100vh;
            position: absolute; /* For smooth transitions between screens */
            width: 100%;
            top: 0;
            left: 0;
            transition: transform 0.4s ease-out, opacity 0.4s ease-out;
            transform: translateX(100%);
            opacity: 0;
        }

        .screen.active {
            display: flex;
            transform: translateX(0);
            opacity: 1;
            position: relative; /* Take up space when active */
        }

        /* Core Aesthetics */
        h1, h2, h3, h4 {
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }
        
        h2 { font-size: 24px; }
        h3 { font-size: 20px; }

        p {
            color: var(--text-color);
            line-height: 1.6;
        }

        /* SVG Icon Styling */
        .icon-svg {
            width: 1em;
            height: 1em;
            fill: currentColor;
        }


        /* Components */
        .btn {
            display: inline-block;
            width: 100%;
            box-sizing: border-box;
            padding: 15px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--light-shadow);
            text-align: center;
        }

        .btn-primary {
            background-image: var(--gradient-primary);
            color: var(--white-color);
        }
        
        .btn-primary:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 140, 66, 0.5);
        }

        .btn-secondary {
            background-image: var(--gradient-secondary);
            color: var(--white-color);
        }

        .btn-secondary:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(10, 36, 99, 0.4);
        }
        
        .btn-danger {
            background: var(--error-color);
            color: var(--white-color);
        }

        .card {
            background-color: var(--white-color);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--light-shadow);
            margin-bottom: 20px;
            transition: transform 0.2s ease;
        }
        .card:hover {
             transform: translateY(-3px);
        }


        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .input-field {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #ddd;
            border-radius: 15px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.2);
        }
        
        .password-toggle {
            position: absolute;
            top: 45px;
            right: 18px;
            cursor: pointer;
            color: #aaa;
            font-size: 22px;
        }
        .password-toggle .icon-svg {
            width: 22px;
            height: 22px;
        }

        /* Screen Specific Styles */
        
        /* Login Screen */
        .login-screen {
            justify-content: center;
            text-align: center;
        }

        .logo {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
            letter-spacing: -1px;
        }
        
        .logo-subtext{
            font-size: 20px;
            color: var(--primary-color);
            margin-bottom: 50px;
            font-weight: 500;
        }

        .greeting {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--primary-color);
        }

        .login-options {
            margin-top: 25px;
            text-align: center;
        }

        .forgot-password {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .forgot-password:hover {
            color: var(--secondary-color);
        }

        .biometric-login {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 40px;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
        }

        .biometric-login .icon {
            font-size: 28px;
            margin-right: 12px;
        }

        /* Home Dashboard */
        .home-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .profile-actions {
            display: flex;
            align-items: center;
        }
        
        .profile-pic {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--secondary-color); /* Default background if no image */
            /* background-image: url('https://i.pravatar.cc/100'); */ /* Removed placeholder image */
            background-size: cover;
            margin-right: 15px;
            cursor: pointer;
            box-shadow: var(--light-shadow);
        }
        
        .notification-bell {
            font-size: 26px;
            color: var(--primary-color);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .notification-bell:active {
            transform: scale(0.9);
        }
        
        .balance-card h3 {
            color: var(--primary-color);
            font-weight: 500;
            font-size: 16px;
        }
        
        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0 15px 0;
            letter-spacing: -0.5px;
        }
        
        .account-details {
            font-size: 14px;
            color: #666;
        }
        
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            text-align: center;
            margin-bottom: 35px;
        }
        
        .action-item {
            background-color: var(--white-color);
            padding: 20px 15px;
            border-radius: 18px;
            box-shadow: var(--light-shadow);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .action-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--dark-shadow);
        }

        .action-item .icon {
            font-size: 32px;
            color: var(--secondary-color);
            margin-bottom: 10px;
            height: 32px; /* Fixed height for icon container */
            display: flex;
            align-items: center;
        }
        
        .action-item span {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .transactions-list {
            margin-top: 10px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-details .name {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .transaction-details .date {
            font-size: 12px;
            color: #999;
        }
        
        .transaction-amount.credit {
            color: var(--tertiary-color);
            font-weight: 700;
            font-size: 15px;
        }
        
        .transaction-amount.debit {
            color: var(--error-color);
            font-weight: 700;
            font-size: 15px;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            display: flex;
            justify-content: space-around;
            background-color: var(--white-color);
            padding: 15px 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            border-top-left-radius: 25px;
            border-top-right-radius: 25px;
            z-index: 50;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .bottom-nav.visible {
            visibility: visible;
            opacity: 1;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease, transform 0.2s ease;
        }
        
        .nav-item.active {
            color: var(--secondary-color);
            transform: translateY(-3px);
        }
        
        .nav-item:hover:not(.active) {
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .nav-item .icon {
            font-size: 26px;
            margin-bottom: 5px;
            height: 26px;
            display: flex;
            align-items: center;
        }
        
        .nav-item span {
            font-size: 13px;
            font-weight: 600;
        }
        
        /* QR Scanner Screen */
        .qr-scanner-screen {
            background: #000;
            justify-content: space-between;
            padding: 0;
            position: relative;
            overflow: hidden;
            color: var(--white-color);
        }
        
        .qr-camera-feed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        
        .qr-header {
            display: flex;
            align-items: center;
            padding: 20px;
            color: var(--white-color);
            background-color: rgba(0,0,0,0.6);
            z-index: 10;
            position: relative;
        }
        
        .qr-header .back-arrow {
            font-size: 28px;
            cursor: pointer;
            margin-right: 15px;
            transition: transform 0.2s ease;
        }
        .qr-header .back-arrow:active {
            transform: translateX(-5px);
        }
        
        .qr-overlay {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--white-color);
            z-index: 5;
            position: relative;
            background-color: rgba(0,0,0,0.4);
            padding: 20px;
        }

        .qr-instruction {
            margin-bottom: 25px;
            font-size: 18px;
            font-weight: 500;
        }
        
        .qr-viewfinder {
            width: 250px;
            height: 250px;
            border: 2px solid var(--white-color);
            position: relative;
        }

        .qr-viewfinder::before, .qr-viewfinder::after,
        .qr-viewfinder > div::before, .qr-viewfinder > div::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border-color: var(--secondary-color);
            border-style: solid;
        }
        
        .qr-viewfinder::before { top: -2px; left: -2px; border-width: 5px 0 0 5px; }
        .qr-viewfinder::after { top: -2px; right: -2px; border-width: 5px 5px 0 0; }
        .qr-viewfinder > div::before { bottom: -2px; left: -2px; border-width: 0 0 5px 5px; }
        .qr-viewfinder > div::after { bottom: -2px; right: -2px; border-width: 0 5px 5px 0; }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .qr-viewfinder {
            animation: pulse 2s infinite ease-in-out;
        }

        .qr-controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            padding: 30px;
            background-color: rgba(0,0,0,0.6);
            z-index: 10;
            position: relative;
        }
        
        .qr-control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--white-color);
            cursor: pointer;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .qr-control-btn:hover {
            color: var(--secondary-color);
        }
        
        .qr-control-btn .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        /* Bill Payments & Generic Pages */
        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .page-header .back-arrow {
            font-size: 28px;
            cursor: pointer;
            margin-right: 15px;
            color: var(--primary-color);
            transition: transform 0.2s ease;
        }
        .page-header .back-arrow:active {
            transform: translateX(-5px);
        }
        
        .search-bar {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #ddd;
            border-radius: 15px;
            font-size: 16px;
            box-sizing: border-box;
            margin-bottom: 25px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .search-bar:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.2);
        }
        
        .biller-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
        }
        
        .biller-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px 20px;
            background-color: var(--white-color);
            border-radius: 18px;
            box-shadow: var(--light-shadow);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .biller-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--dark-shadow);
        }
        
        .biller-card .icon {
            font-size: 38px;
            margin-bottom: 15px;
            height: 38px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
        }

        .biller-card span {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }

        /* Generic Form and Info Screen Styles */
        .form-section {
            margin-top: 20px;
        }
        
        .info-display {
            background-color: var(--white-color);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--light-shadow);
            margin-bottom: 25px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            font-size: 15px;
            color: #666;
            font-weight: 500;
        }
        .info-value {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 16px;
            text-align: right;
        }

        /* Confirmation / Message Box */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        .message-box-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .message-box {
            background-color: var(--white-color);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--dark-shadow);
            text-align: center;
            width: 85%;
            max-width: 350px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .message-box-overlay.active .message-box {
            transform: scale(1);
        }

        .message-box .icon {
            font-size: 56px;
            margin-bottom: 20px;
            height: 56px;
        }

        .message-box h3 {
            margin-bottom: 15px;
            font-size: 22px;
            font-weight: 700;
            line-height: 1.3;
        }

        .message-box.success .icon, .message-box.success h3 { color: var(--tertiary-color); }
        .message-box.error .icon, .message-box.error h3 { color: var(--error-color); }
        .message-box.info .icon, .message-box.info h3 { color: var(--primary-color); }

        .message-box p {
            font-size: 16px;
            color: #555;
            margin-bottom: 25px;
        }
        
        /* Transaction PIN Screen Specific Styles */
        .transaction-pin-screen .page-header { margin-bottom: 40px; }
        .pin-input-group { margin-top: 30px; margin-bottom: 40px; text-align: center; }
        .pin-input-group label { font-size: 18px; color: var(--primary-color); margin-bottom: 20px; }
        
        .pin-input-field {
            width: 150px;
            text-align: center;
            font-size: 24px;
            letter-spacing: 10px;
            font-family: monospace;
            padding: 15px 20px;
        }

        .pin-actions { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }

        /* Load Wallet Screen specific styles */
        .wallet-option-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px; }
        
        .wallet-option-card {
            background-color: var(--white-color);
            border-radius: 18px;
            box-shadow: var(--light-shadow);
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .wallet-option-card:hover { transform: translateY(-5px); box-shadow: var(--dark-shadow); }
        .wallet-option-card .icon { font-size: 48px; margin-bottom: 15px; height: 48px; display: flex; align-items: center; }
        .wallet-option-card .icon-esewa { color: #60B84B; }
        .wallet-option-card .icon-khalti { color: #5D2E8E; }
        .wallet-option-card span { font-weight: 600; color: var(--primary-color); font-size: 16px; }

        /* Profile Screen specific styles */
        .profile-section { text-align: center; margin-bottom: 20px; }
        
        .profile-picture-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--primary-color); /* Default background if no image */
            /* background-image: url('https://i.pravatar.cc/150'); */ /* Removed placeholder image */
            background-size: cover;
            margin: 0 auto 20px auto;
            display: block;
            box-shadow: var(--dark-shadow);
            border: 3px solid var(--white-color);
        }

        .profile-name { font-size: 28px; font-weight: 700; color: var(--primary-color); margin-bottom: 10px; }
        .profile-phone, .profile-email, .profile-address, .profile-age, .profile-occupation {
            font-size: 16px;
            color: #666;
            margin-bottom: 5px;
            line-height: 1.5;
        }
        .profile-edit-btn { margin-top: 20px; width: auto; padding: 10px 30px; }
    </style>
</head>
<body>
    
    <svg width="0" height="0" style="display:none;">
        <symbol id="icon-eye-open" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 7.61 17 4.5 12 4.5zm0 12c-2.48 0-4.5-2.02-4.5-4.5S9.52 7.5 12 7.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7C10.62 9.5 9.5 10.62 9.5 12s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5-1.12-2.5-2.5-2.5z"/></symbol>
        <symbol id="icon-eye-closed" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L21.73 22 20.46 23.27 3.27 6 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.48 0-4.5-2.02-4.5-4.5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></symbol>
        <symbol id="icon-biometric" viewBox="0 0 24 24"><path d="M9 11.75c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zM12 9.25c-2.07 0-3.75 1.68-3.75 3.75s1.68 3.75 3.75 3.75 3.75-1.68 3.75-3.75-1.68-3.75-3.75-3.75zm0 6c-1.24 0-2.25-1.01-2.25-2.25S10.76 10.75 12 10.75s2.25 1.01 2.25 2.25-1.01 2.25-2.25 2.25zM15 11.75c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></symbol>
        <symbol id="icon-bell" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></symbol>
        <symbol id="icon-fund-transfer" viewBox="0 0 24 24"><path d="M15 16h5v-2h-5v2zm-1.5-6L10 6.5V9H2V7h8V4.5L13.5 8zM9 18h5v-2H9v2zm1.5-6L14 8.5V11h8v2h-8v2.5L10.5 12z"/></symbol>
        <symbol id="icon-qr-code" viewBox="0 0 24 24"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm8-12v8h8V3h-8zm6 6h-4V5h4v4zm-6 8h8v-8h-8v8zm2-6h4v4h-4v-4z"/></symbol>
        <symbol id="icon-top-up" viewBox="0 0 24 24"><path d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-2-3-2zm-5 15h2V8h-2v8zm-2-2h6V6h-6v8z"/></symbol>
        <symbol id="icon-bills" viewBox="0 0 24 24"><path d="M18 17H6v-2h12v2zm0-4H6v-2h12v2zm0-4H6V7h12v2zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2l-1.5 1.5L6 2l-1.5 1.5L3 2v20z"/></symbol>
        <symbol id="icon-load-wallet" viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></symbol>
        <symbol id="icon-statement" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></symbol>
        <symbol id="icon-home" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></symbol>
        <symbol id="icon-user" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></symbol>
        <symbol id="icon-back-arrow" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></symbol>
        <symbol id="icon-check-circle" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></symbol>
        <symbol id="icon-error-circle" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></symbol>
        <symbol id="icon-info-circle" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></symbol>
    </svg>

    <div class="app-container">

        <div id="login-screen" class="screen active">
            <div class="logo">KNB</div>
            <div class="logo-subtext">‡§ï‡•Å‡§≤‡•å‡§® ‡§®‡§Ø‡§æ‡§Å ‡§¨‡•à‡§Ç‡§ï</div>

            <h2 class="greeting">Welcome Back!</h2>
            
            <div class="input-group">
                <label for="full-name">Full Name</label>
                <input type="text" id="full-name" class="input-field" placeholder="Enter your full Name">
            </div>

            <div class="input-group">
                <label for="mobile-number">Mobile Number</label>
                <input type="tel" id="mobile-number" class="input-field" placeholder="Enter your 10-digit mobile number">
            </div>

            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="input-field" placeholder="Enter your password">
                <span id="toggle-password" class="password-toggle">
                     <svg class="icon-svg"><use href="#icon-eye-open"></use></svg>
                </span>
            </div>

            <button class="btn btn-primary" onclick="loginAndNavigate()">Login</button>

            <div class="login-options">
                <a href="#" class="forgot-password">Forgot Password?</a>
            </div>
            
            <div class="biometric-login">
                <span class="icon"><svg class="icon-svg"><use href="#icon-biometric"></use></svg></span>
                <span>Login with Biometrics</span>
            </div>
        </div>

        <div id="home-dashboard" class="screen">
            <div class="home-header">
                <div>
           
         <p style="margin:0; font-size: 50px">‡§ï‡•Å‡§≤‡•å‡§® ‡§®‡§Ø‡§æ‡§Å ‡§¨‡•à‡§Ç‡§ï</p>
                 <p style="margin:0; font-size: 30px">Namaste üôè  ,</p>
     <h2 style="margin:0; font-size: 40px" id="account-holder-name"></h2>
                </div>
                <div class="profile-actions">
                    <div class="profile-pic" onclick="navigateTo('profile-screen')"></div>
                    <span class="notification-bell">
                        <svg class="icon-svg"><use href="#icon-bell"></use></svg>
                    </span>
                </div>
            </div>

            <div class="card balance-card">
                <h3>Available Balance</h3>
                <h1 class="balance-amount" id="current-balance-display">NPR 25,34,578.00</h1>
                <p class="account-details">Kulaun Naya Premium Savings<br>AC: <span id="account-number-display"></span></p>
            </div>

            <div class="quick-actions-grid">
                <div class="action-item" onclick="initiateFundTransfer()">
                    <div class="icon"><svg class="icon-svg"><use href="#icon-fund-transfer"></use></svg></div>
                    <span>Fund Transfer</span>
                </div>
                 <div class="action-item" onclick="navigateTo('qr-scanner-screen')">
                    <div class="icon"><svg class="icon-svg"><use href="#icon-qr-code"></use></svg></div>
                    <span>Scan to Pay</span>
                </div>
                <div class="action-item" onclick="initiateMobileTopup()">
                    <div class="icon"><svg class="icon-svg"><use href="#icon-top-up"></use></svg></div>
                    <span>Mobile Top-up</span>
                </div>
                <div class="action-item" onclick="navigateTo('bill-payments-screen')">
                    <div class="icon"><svg class="icon-svg"><use href="#icon-bills"></use></svg></div>
                    <span>Bill Payments</span>
                </div>
                <div class="action-item" onclick="navigateTo('load-wallet-screen')">
                    <div class="icon"><svg class="icon-svg"><use href="#icon-load-wallet"></use></svg></div>
                    <span>Load Wallet</span>
                </div>
                <div class="action-item" onclick="navigateTo('statement-screen')">
                    <div class="icon"><svg class="icon-svg"><use href="#icon-statement"></use></svg></div>
                    <span>Statement</span>
                </div>
            </div>

            <h3>Recent Transactions</h3>
            <div class="transactions-list" id="recent-transactions-list">
                </div>
            
             <div style="height: 80px;"></div>
        </div>
        
        <div id="qr-scanner-screen" class="screen qr-scanner-screen">
            <video id="qr-video" class="qr-camera-feed" autoplay playsinline></video>

            <div class="qr-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h3>Scan & Pay</h3>
            </div>

            <div class="qr-overlay">
                <p class="qr-instruction">Point your camera at a QR code</p>
                <div class="qr-viewfinder"><div></div></div>
                 <button class="btn btn-secondary" style="margin-top: 30px; width: auto; padding: 10px 20px;" onclick="simulateQrScan()">Simulate Scan</button>
            </div>
            
            <div class="qr-controls">
                <div class="qr-control-btn">
                    <span class="icon">üñºÔ∏è</span>
                    <span>Upload QR</span>
                </div>
                <div class="qr-control-btn">
                    <span class="icon">üí°</span>
                    <span>Flashlight</span>
                </div>
            </div>
        </div>

        <div id="qr-payment-details-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Confirm QR Payment</h2>
            </div>
            <div class="info-display">
                <div class="info-row">
                    <span class="info-label">Payee Name</span>
                    <span class="info-value" id="qr-payee-name"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Amount</span>
                    <span class="info-value" id="qr-payment-amount"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Remarks</span>
                    <span class="info-value" id="qr-payment-remarks"></span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="confirmQrPaymentInitiate()">Confirm Payment</button>
        </div>

        <div id="bill-payments-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Bill Payments</h2>
            </div>
            
            <input type="text" class="search-bar" placeholder="Search for biller (e.g., NEA, Worldlink...)">
            
            <div class="biller-grid">
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üí°</div><span>Electricity</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üåê</div><span>Internet</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üíß</div><span>Water</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üì±</div><span>Mobile Postpaid</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üì∫</div><span>TV</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üèõÔ∏è</div><span>Govt. Payments</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üõ°Ô∏è</div><span>Insurance</span></div>
                <div class="biller-card" onclick="alert('This feature is for demonstration only.')"><div class="icon">üí≥</div><span>Credit Card</span></div>
            </div>
        </div>

        <div id="mobile-topup-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Mobile Top-up</h2>
            </div>
            <div class="form-section">
                <div class="input-group">
                    <label for="topup-mobile-number">Mobile Number</label>
                    <input type="tel" id="topup-mobile-number" class="input-field" placeholder="Enter mobile number">
                </div>
                <div class="input-group">
                    <label for="topup-amount">Amount (NPR)</label>
                    <input type="number" id="topup-amount" class="input-field" placeholder="e.g., 100, 500">
                </div>
                <button class="btn btn-primary" onclick="initiateMobileTopupTransaction()">Top Up Now</button>
            </div>
        </div>

        <div id="fund-transfer-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Fund Transfer</h2>
            </div>
            <div class="form-section">
                <div class="input-group">
                    <label for="recipient-name">Recipient Name</label>
                    <input type="text" id="recipient-name" class="input-field" placeholder="e.g., John Rai">
                </div>
                <div class="input-group">
                    <label for="recipient-account">Recipient Account Number</label>
                    <input type="text" id="recipient-account" class="input-field" placeholder="Enter account number">
                </div>
                <div class="input-group">
                    <label for="recipient-bank">Recipient Bank</label>
                    <input type="text" id="recipient-bank" class="input-field" value="Global IME Bank" placeholder="e.g., Global IME Bank">
                </div>
                <div class="input-group">
                    <label for="transfer-amount">Amount (NPR)</label>
                    <input type="number" id="transfer-amount" class="input-field" placeholder="e.g., 10000">
                </div>
                <button class="btn btn-primary" onclick="initiateFundTransferTransaction()">Send Money</button>
            </div>
        </div>

        <div id="statement-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Account Statement</h2>
            </div>
            <div class="card balance-card">
                 <h3>Current Balance</h3>
                <h2 class="balance-amount" id="statement-balance-display">NPR 0.00</h1>
            </div>
            <h3>All Transactions</h3>
            <div class="transactions-list" id="full-statement-list">
                </div>
            <div style="height: 100px;"></div>
        </div>

        <div id="transaction-pin-screen" class="screen transaction-pin-screen">
            <div class="page-header">
                <span class="back-arrow" onclick="cancelTransaction()"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Confirm Transaction</h2>
            </div>
            <div class="info-display" id="pin-transaction-summary">
                </div>
            <div class="input-group pin-input-group">
                <label for="transaction-pin">Enter your 4-digit PIN</label>
                <input type="password" id="transaction-pin" class="input-field pin-input-field" maxlength="4" pattern="\d{4}" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div class="pin-actions">
                <button class="btn btn-primary" onclick="confirmTransactionPin()">Confirm</button>
                <button class="btn btn-danger" onclick="cancelTransaction()">Cancel</button>
            </div>
        </div>

        <div id="load-wallet-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Load From Wallet/Bank</h2>
            </div>
            <p>Choose a service to load money from:</p>
            <div class="wallet-option-grid">
                <div class="wallet-option-card" onclick="navigateTo('esewa-load-screen')">
                    <div class="icon icon-esewa"> Send </div>
                    <span>Esewa</span>
                </div>
                <div class="wallet-option-card" onclick="navigateTo('khalti-load-screen')">
                    <div class="icon icon-khalti">üí∞</div>
                    <span>Khalti</span>
                </div>
            </div>
        </div>

        <div id="esewa-load-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('load-wallet-screen')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Load via Esewa</h2>
            </div>
            <div class="form-section">
                <div class="input-group">
                    <label for="esewa-mobile-number">Esewa Mobile Number</label>
                    <input type="tel" id="esewa-mobile-number" class="input-field" placeholder="Enter Esewa registered mobile number">
                </div>
                <div class="input-group">
                    <label for="esewa-amount">Amount (NPR)</label>
                    <input type="number" id="esewa-amount" class="input-field" placeholder="e.g., 1000, 5000">
                </div>
                <button class="btn btn-primary" onclick="initiateEsewaLoad()">Load Funds</button>
            </div>
        </div>

        <div id="khalti-load-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('load-wallet-screen')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Load via Khalti</h2>
            </div>
            <div class="form-section">
                <div class="input-group">
                    <label for="khalti-mobile-number">Khalti Mobile Number</label>
                    <input type="tel" id="khalti-mobile-number" class="input-field" placeholder="Enter Khalti registered mobile number">
                </div>
                <div class="input-group">
                    <label for="khalti-amount">Amount (NPR)</label>
                    <input type="number" id="khalti-amount" class="input-field" placeholder="e.g., 1000, 5000">
                </div>
                <button class="btn btn-primary" onclick="initiateKhaltiLoad()">Load Funds</button>
            </div>
        </div>

        <div id="profile-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('home-dashboard')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>My Profile</h2>
            </div>
            <div class="card profile-section">
                <div class="profile-picture-large"></div>
                <h3 class="profile-name" id="profile-display-name"></h3>
                <p class="profile-phone"><strong>Phone:</strong> <span id="profile-display-phone"></span></p>
                <p class="profile-email"><strong>Email:</strong> <span id="profile-display-email"></span></p>
                <p class="profile-address"><strong>Address:</strong> <span id="profile-display-address"></span></p>
                <p class="profile-age"><strong>Age:</strong> <span id="profile-display-age"></span></p>
                <p class="profile-occupation"><strong>Occupation:</strong> <span id="profile-display-occupation"></span></p>
                <button class="btn btn-secondary profile-edit-btn" onclick="navigateTo('edit-profile-screen')">Edit Profile</button>
            </div>
            <div class="card">
                <h3>Account Information</h3>
                <div class="info-row">
                    <span class="info-label">Account Type</span>
                    <span class="info-value">Premium Savings</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Account No.</span>
                    <span class="info-value" id="profile-account-no"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Branch</span>
                    <span class="info-value">Kathmandu Main</span>
                </div>
            </div>
        </div>

        <div id="edit-profile-screen" class="screen">
            <div class="page-header">
                <span class="back-arrow" onclick="navigateTo('profile-screen')"><svg class="icon-svg"><use href="#icon-back-arrow"></use></svg></span>
                <h2>Edit Profile</h2>
            </div>
            <div class="form-section">
                <div class="input-group">
                    <label for="edit-profile-name">Full Name</label>
                    <input type="text" id="edit-profile-name" class="input-field" placeholder="Enter your full name">
                </div>
                 <div class="input-group">
                    <label for="edit-profile-email">Email</label>
                    <input type="email" id="edit-profile-email" class="input-field" placeholder="Enter your email">
                </div>
                <div class="input-group">
                    <label for="edit-profile-address">Address</label>
                    <input type="text" id="edit-profile-address" class="input-field" placeholder="e.g., Kathmandu, Nepal">
                </div>
                <div class="input-group">
                    <label for="edit-profile-age">Age</label>
                    <input type="number" id="edit-profile-age" class="input-field" placeholder="e.g., 30">
                </div>
                <div class="input-group">
                    <label for="edit-profile-occupation">Occupation</label>
                    <input type="text" id="edit-profile-occupation" class="input-field" placeholder="e.g., Software Engineer">
                </div>
                <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
            </div>
        </div>


        <nav id="bottom-nav" class="bottom-nav">
            <div class="nav-item" data-screen="home-dashboard" onclick="navigateTo('home-dashboard')">
                <div class="icon"><svg class="icon-svg"><use href="#icon-home"></use></svg></div>
                <span>Home</span>
            </div>
             <div class="nav-item" data-screen="bill-payments-screen" onclick="navigateTo('bill-payments-screen')">
                <div class="icon"><svg class="icon-svg"><use href="#icon-bills"></use></svg></div>
                <span>Payments</span>
            </div>
             <div class="nav-item" data-screen="fund-transfer-screen" onclick="initiateFundTransfer()">
                <div class="icon"><svg class="icon-svg"><use href="#icon-fund-transfer"></use></svg></div>
                <span>Transfer</span>
            </div>
             <div class="nav-item" data-screen="profile-screen" onclick="navigateTo('profile-screen')">
                <div class="icon"><svg class="icon-svg"><use href="#icon-user"></use></svg></div>
                <span>Profile</span>
            </div>
        </nav>

        <div id="message-box-overlay" class="message-box-overlay">
            <div id="message-box" class="message-box">
                <div class="icon" id="message-icon"></div>
                <h3 id="message-title"></h3>
                <p id="message-text"></p>
                <button onclick="hideMessageBox()">OK</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * =================================================================
         * KNB MOBILE BANKING APP - PROTOTYPE SCRIPT
         * =================================================================
         * This script manages the entire single-page application (SPA)
         * functionality, including navigation, state management,
         * transaction processing, and user interactions.
         */

        // -----------------------------------------------------------------
        // 1. GLOBAL STATE & CONFIGURATION
        // -----------------------------------------------------------------
        
        let currentScreen = 'login-screen';
        const CORRECT_PIN = "1234"; // Hardcoded PIN for demo purposes

        // Application-wide state object to hold all dynamic data.
        const AppState = {
            userProfile: {
                fullName: '',
                mobileNumber: '',
                address: '',
                age: '',
                occupation: '',
                email: ''
            },
            account: {
                balance: 2572450.75, // Initial balance
                transactions: [] // Holds all transaction records
            },
            // Temporarily stores transaction details before PIN confirmation
            activeTransaction: {
                type: null, // e.g., 'mobileTopup', 'fundTransfer'
                details: {} // Specifics of the transaction
            }
        };

        // -----------------------------------------------------------------
        // 2. NAVIGATION & SCREEN MANAGEMENT
        // -----------------------------------------------------------------

        /**
         * Handles transitions between different screens of the application.
         * @param {string} screenId The ID of the screen to navigate to.
         */
        function navigateTo(screenId) {
            if (currentScreen === 'qr-scanner-screen' && screenId !== 'qr-scanner-screen') {
                stopCamera();
            }

            const activeScreen = document.querySelector('.screen.active');
            if (activeScreen) {
                activeScreen.classList.remove('active');
            }
            
            // A small delay to allow the fade-out transition to complete before showing the new screen.
            setTimeout(() => {
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    currentScreen = screenId;
                    
                    // Run screen-specific setup functions
                    onScreenLoad(screenId);
                }
            }, 50); // A minimal delay for smoother visual transition
        }

        /**
         * Executes specific logic when a screen becomes active.
         * This keeps the navigation function clean and modularizes screen setup.
         * @param {string} screenId The ID of the newly loaded screen.
         */
        function onScreenLoad(screenId) {
            const bottomNav = document.getElementById('bottom-nav');
            const mainScreens = ['home-dashboard', 'bill-payments-screen', 'statement-screen', 'profile-screen', 'load-wallet-screen'];
            
            if (mainScreens.includes(screenId)) {
                bottomNav.classList.add('visible');
            } else {
                bottomNav.classList.remove('visible');
            }
            
            updateBottomNav(screenId);
            
            switch(screenId) {
                case 'home-dashboard':
                    renderTransactions('recent-transactions-list', 3);
                    updateBalanceDisplay();
                    document.getElementById('account-holder-name').textContent = AppState.userProfile.fullName;
                    break;
                case 'statement-screen':
                    renderTransactions('full-statement-list');
                    document.getElementById('statement-balance-display').textContent = formatCurrency(AppState.account.balance);
                    break;
                case 'qr-scanner-screen':
                    startCamera();
                    break;
                case 'transaction-pin-screen':
                    document.getElementById('transaction-pin').value = '';
                    document.getElementById('transaction-pin').focus();
                    break;
                case 'profile-screen':
                    populateProfileView();
                    break;
                case 'edit-profile-screen':
                    populateProfileEditForm();
                    break;
            }
        }
        
        /**
         * Updates the active state of the bottom navigation bar items.
         * @param {string} screenId The current active screen ID.
         */
        function updateBottomNav(screenId) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.dataset.screen === screenId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        // -----------------------------------------------------------------
        // 3. USER AUTHENTICATION & PROFILE
        // -----------------------------------------------------------------
        
        /**
         * Simulates user login, validates input, and navigates to the dashboard.
         */
        function loginAndNavigate() {
            const fullNameInput = document.getElementById('full-name');
            const mobileNumberInput = document.getElementById('mobile-number');
            const passwordInput = document.getElementById('password');

            if (fullNameInput.value.length < 3) {
                showMessageBox('error', 'Login Failed', 'Please enter a valid full name.');
                return;
            }
            if (!/^\d{10}$/.test(mobileNumberInput.value)) {
                showMessageBox('error', 'Login Failed', 'Mobile number must be exactly 10 digits.');
                return;
            }
            if (passwordInput.value.length < 8) {
                showMessageBox('error', 'Login Failed', 'Password must be at least 8 characters long.');
                return;
            }

            // Store user profile data upon successful login
            AppState.userProfile.fullName = fullNameInput.value;
            AppState.userProfile.mobileNumber = mobileNumberInput.value;
            
            // Set account number display based on mobile number
            document.getElementById('account-number-display').textContent = `${mobileNumberInput.value.substring(0, 4)}...${mobileNumberInput.value.substring(6)}`;
            document.getElementById('profile-account-no').textContent = `${mobileNumberInput.value.substring(0, 4)}...${mobileNumberInput.value.substring(6)}`;
            
            navigateTo('home-dashboard');
        }

        /** Populates the profile viewing screen with data from AppState. */
        function populateProfileView() {
            const { fullName, mobileNumber, email, address, age, occupation } = AppState.userProfile;
            document.getElementById('profile-display-name').textContent = fullName || 'N/A';
            document.getElementById('profile-display-phone').textContent = mobileNumber || 'N/A';
            document.getElementById('profile-display-email').textContent = email || 'N/A';
            document.getElementById('profile-display-address').textContent = address || 'N/A';
            document.getElementById('profile-display-age').textContent = age || 'N/A';
            document.getElementById('profile-display-occupation').textContent = occupation || 'N/A';
        }

        /** Populates the profile editing form with data from AppState. */
        function populateProfileEditForm() {
            const { fullName, email, address, age, occupation } = AppState.userProfile;
            document.getElementById('edit-profile-name').value = fullName;
            document.getElementById('edit-profile-email').value = email;
            document.getElementById('edit-profile-address').value = address;
            document.getElementById('edit-profile-age').value = age;
            document.getElementById('edit-profile-occupation').value = occupation;
        }

        /** Saves the edited profile data back to the AppState. */
        function saveProfile() {
            AppState.userProfile.fullName = document.getElementById('edit-profile-name').value;
            AppState.userProfile.email = document.getElementById('edit-profile-email').value;
            AppState.userProfile.address = document.getElementById('edit-profile-address').value;
            AppState.userProfile.age = document.getElementById('edit-profile-age').value;
            AppState.userProfile.occupation = document.getElementById('edit-profile-occupation').value;
            
            showMessageBox('success', 'Profile Updated', 'Your information has been saved successfully.', () => {
                navigateTo('profile-screen');
            });
        }
        
        // -----------------------------------------------------------------
        // 4. TRANSACTION PROCESSING & PIN FLOW
        // -----------------------------------------------------------------
        
        /**
         * Central function to start any transaction. It populates the active
         * transaction object and navigates to the PIN confirmation screen.
         * @param {string} type The type of transaction (e.g., 'fundTransfer').
         * @param {object} details The specific data for the transaction.
         */
        function initiateTransaction(type, details) {
            // For debit transactions, check for sufficient funds first.
            if (details.amount > AppState.account.balance && (type !== 'esewaLoad' && type !== 'khaltiLoad')) {
                showMessageBox('error', 'Insufficient Funds', `Your balance is not sufficient for this transaction of ${formatCurrency(details.amount)}.`);
                return;
            }

            AppState.activeTransaction = { type, details };
            
            const summaryDiv = document.getElementById('pin-transaction-summary');
            let summaryHtml = '';

            switch(type) {
                case 'mobileTopup':
                    summaryHtml = `
                        <div class="info-row"><span class="info-label">Type</span><span class="info-value">Mobile Top-up</span></div>
                        <div class="info-row"><span class="info-label">Mobile No.</span><span class="info-value">${details.mobileNumber}</span></div>
                        <div class="info-row"><span class="info-label">Amount</span><span class="info-value">${formatCurrency(details.amount)}</span></div>`;
                    break;
                case 'fundTransfer':
                    summaryHtml = `
                        <div class="info-row"><span class="info-label">Type</span><span class="info-value">Fund Transfer</span></div>
                        <div class="info-row"><span class="info-label">To</span><span class="info-value">${details.recipientName}</span></div>
                        <div class="info-row"><span class="info-label">Account</span><span class="info-value">${details.recipientAccount}</span></div>
                        <div class="info-row"><span class="info-label">Amount</span><span class="info-value">${formatCurrency(details.amount)}</span></div>`;
                    break;
                case 'qrPayment':
                    summaryHtml = `
                        <div class="info-row"><span class="info-label">Type</span><span class="info-value">QR Payment</span></div>
                        <div class="info-row"><span class="info-label">Payee</span><span class="info-value">${details.payee}</span></div>
                        <div class="info-row"><span class="info-label">Amount</span><span class="info-value">${formatCurrency(details.amount)}</span></div>`;
                    break;
                case 'esewaLoad':
                case 'khaltiLoad':
                     summaryHtml = `
                        <div class="info-row"><span class="info-label">Type</span><span class="info-value">${type === 'esewaLoad' ? 'Esewa Load' : 'Khalti Load'}</span></div>
                        <div class="info-row"><span class="info-label">From</span><span class="info-value">${details.mobileNumber}</span></div>
                        <div class="info-row"><span class="info-label">Amount</span><span class="info-value">${formatCurrency(details.amount)}</span></div>`;
                    break;
            }
            summaryDiv.innerHTML = summaryHtml;
            navigateTo('transaction-pin-screen');
        }

        /**
         * Validates the entered PIN and processes the stored active transaction.
         */
        function confirmTransactionPin() {
            const enteredPin = document.getElementById('transaction-pin').value;
            if (enteredPin !== CORRECT_PIN) {
                showMessageBox('error', 'Invalid PIN', 'The transaction PIN is incorrect. Please try again.');
                document.getElementById('transaction-pin').value = '';
                return;
            }
            
            // PIN is correct, execute the transaction
            const { type, details } = AppState.activeTransaction;
            let transactionRecord;
            let successMessage;

            switch(type) {
                case 'mobileTopup':
                    AppState.account.balance -= details.amount;
                    transactionRecord = { name: `Mobile Top-up to ${details.mobileNumber}`, amount: details.amount, type: 'debit' };
                    successMessage = `Top-up of ${formatCurrency(details.amount)} to ${details.mobileNumber} was successful.`;
                    break;
                case 'fundTransfer':
                    AppState.account.balance -= details.amount;
                    transactionRecord = { name: `Transfer to ${details.recipientName}`, amount: details.amount, type: 'debit' };
                    successMessage = `${formatCurrency(details.amount)} sent to ${details.recipientName}.`;
                    break;
                case 'qrPayment':
                    AppState.account.balance -= details.amount;
                    transactionRecord = { name: `QR Payment to ${details.payee}`, amount: details.amount, type: 'debit' };
                    successMessage = `Payment of ${formatCurrency(details.amount)} to ${details.payee} was successful.`;
                    break;
                case 'esewaLoad':
                    AppState.account.balance += details.amount;
                    transactionRecord = { name: `Loaded from Esewa`, amount: details.amount, type: 'credit' };
                    successMessage = `${formatCurrency(details.amount)} has been loaded to your account from Esewa.`;
                    break;
                case 'khaltiLoad':
                    AppState.account.balance += details.amount;
                    transactionRecord = { name: `Loaded from Khalti`, amount: details.amount, type: 'credit' };
                    successMessage = `${formatCurrency(details.amount)} has been loaded to your account from Khalti.`;
                    break;
            }
            
            addTransaction(transactionRecord.name, transactionRecord.amount, transactionRecord.type);
            showMessageBox('success', 'Transaction Successful!', successMessage, () => {
                // Clear relevant forms
                if(document.getElementById(`${type}-screen`)) {
                    document.getElementById(`${type}-screen`).querySelectorAll('input').forEach(input => input.value = '');
                }
                navigateTo('home-dashboard');
            });
            
            // Reset active transaction
            AppState.activeTransaction = { type: null, details: {} };
        }
        
        /**
         * Cancels the transaction from the PIN screen and clears active data.
         */
        function cancelTransaction() {
            AppState.activeTransaction = { type: null, details: {} };
            showMessageBox('info', 'Transaction Cancelled', 'Your transaction has been cancelled.', () => {
                navigateTo('home-dashboard');
            });
        }
        
        // -----------------------------------------------------------------
        // 5. FEATURE-SPECIFIC INITIATORS
        // -----------------------------------------------------------------

        function initiateMobileTopup() { navigateTo('mobile-topup-screen'); }
        function initiateFundTransfer() { navigateTo('fund-transfer-screen'); }

        function initiateMobileTopupTransaction() {
            const mobileNumber = document.getElementById('topup-mobile-number').value;
            const amount = parseFloat(document.getElementById('topup-amount').value);
            if (mobileNumber && amount > 0) {
                initiateTransaction('mobileTopup', { mobileNumber, amount });
            } else {
                showMessageBox('error', 'Invalid Input', 'Please enter a valid mobile number and amount.');
            }
        }

        function initiateFundTransferTransaction() {
            const recipientName = document.getElementById('recipient-name').value;
            const recipientAccount = document.getElementById('recipient-account').value;
            const amount = parseFloat(document.getElementById('transfer-amount').value);
            if (recipientName && recipientAccount && amount > 0) {
                initiateTransaction('fundTransfer', { recipientName, recipientAccount, amount });
            } else {
                showMessageBox('error', 'Invalid Input', 'Please fill in all recipient details and a valid amount.');
            }
        }
        
        function initiateEsewaLoad() {
            const mobileNumber = document.getElementById('esewa-mobile-number').value;
            const amount = parseFloat(document.getElementById('esewa-amount').value);
            if (mobileNumber && amount > 0) {
                // NOTE: In a real app, this would redirect to Esewa. Here, we go to PIN to simulate confirmation.
                initiateTransaction('esewaLoad', { mobileNumber, amount });
            } else {
                 showMessageBox('error', 'Invalid Input', 'Please enter a valid Esewa ID and amount.');
            }
        }
        
         function initiateKhaltiLoad() {
            const mobileNumber = document.getElementById('khalti-mobile-number').value;
            const amount = parseFloat(document.getElementById('khalti-amount').value);
            if (mobileNumber && amount > 0) {
                initiateTransaction('khaltiLoad', { mobileNumber, amount });
            } else {
                 showMessageBox('error', 'Invalid Input', 'Please enter a valid Khalti ID and amount.');
            }
        }

        function simulateQrScan() {
            stopCamera();
            document.getElementById('qr-payee-name').textContent = 'Local Mart Pvt. Ltd.';
            document.getElementById('qr-payment-amount').textContent = formatCurrency(1250.75);
            document.getElementById('qr-payment-remarks').textContent = 'Groceries';
            navigateTo('qr-payment-details-screen');
        }

        function confirmQrPaymentInitiate() {
            const payee = document.getElementById('qr-payee-name').textContent;
            const amountText = document.getElementById('qr-payment-amount').textContent.replace(/NPR|,/g, '').trim();
            const amount = parseFloat(amountText);
            const remarks = document.getElementById('qr-payment-remarks').textContent;

            if (payee && amount > 0) {
                initiateTransaction('qrPayment', { payee, amount, remarks });
            } else {
                showMessageBox('error', 'QR Error', 'Could not retrieve QR payment details. Please try again.');
            }
        }
        
        // -----------------------------------------------------------------
        // 6. UI & DATA RENDERING
        // -----------------------------------------------------------------
        
        /**
         * Formats a number into the NPR currency format.
         * @param {number} amount The number to format.
         * @returns {string} The formatted currency string.
         */
        function formatCurrency(amount) {
            return `NPR ${amount.toLocaleString('en-NP', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }
        
        /** Updates the balance display on the home dashboard. */
        function updateBalanceDisplay() {
            document.getElementById('current-balance-display').textContent = formatCurrency(AppState.account.balance);
        }
        
        /**
         * Creates a transaction record and adds it to the state.
         * @param {string} name Description of the transaction.
         * @param {number} amount The transaction amount.
         * @param {string} type 'credit' or 'debit'.
         */
        function addTransaction(name, amount, type) {
            const transaction = {
                name,
                amount,
                type,
                date: new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })
            };
            AppState.account.transactions.unshift(transaction);
        }

        /**
         * Renders transaction history into a specified list element.
         * @param {string} listId The ID of the HTML element to render into.
         * @param {number} [limit=-1] The maximum number of transactions to show. -1 for all.
         */
        function renderTransactions(listId, limit = -1) {
            const listElement = document.getElementById(listId);
            listElement.innerHTML = '';
            const transactionsToDisplay = limit === -1 ? AppState.account.transactions : AppState.account.transactions.slice(0, limit);

            if (transactionsToDisplay.length === 0) {
                listElement.innerHTML = '<p style="text-align: center; color: #999; padding: 20px 0;">No transactions yet.</p>';
                return;
            }

            transactionsToDisplay.forEach(tx => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-details">
                        <div class="name">${tx.name}</div>
                        <div class="date">${tx.date}</div>
                    </div>
                    <div class="transaction-amount ${tx.type}">
                        ${tx.type === 'debit' ? '-' : '+'} ${formatCurrency(tx.amount)}
                    </div>`;
                listElement.appendChild(item);
            });
        }

        // -----------------------------------------------------------------
        // 7. UTILITY & MISC
        // -----------------------------------------------------------------
        
        /**
         * Displays a global, non-blocking message box.
         * @param {'success'|'error'|'info'} type The type of message.
         * @param {string} title The title of the message box.
         * @param {string} message The main text of the message.
         * @param {function} [callback] A function to run after the user clicks OK.
         */
        function showMessageBox(type, title, message, callback) {
            const overlay = document.getElementById('message-box-overlay');
            const box = document.getElementById('message-box');
            const icon = document.getElementById('message-icon');
            
            box.className = 'message-box ' + type;
            icon.innerHTML = `<svg class="icon-svg"><use href="#icon-${type}-circle"></use></svg>`;
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-text').textContent = message;

            const okButton = box.querySelector('button');
            okButton.onclick = () => {
                hideMessageBox();
                if (callback) callback();
            };
            overlay.classList.add('active');
        }

        function hideMessageBox() {
            document.getElementById('message-box-overlay').classList.remove('active');
        }
        
        // --- QR Camera Controls ---
        let mediaStream = null;
        async function startCamera() {
            if (mediaStream) return;
            try {
                const videoEl = document.getElementById('qr-video');
                mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                videoEl.srcObject = mediaStream;
                videoEl.play();
            } catch (err) {
                console.error("Camera Error:", err);
                showMessageBox('error', 'Camera Access Denied', 'Please allow camera access to use the QR scanner.', () => navigateTo('home-dashboard'));
            }
        }

        function stopCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
                document.getElementById('qr-video').srcObject = null;
            }
        }

        // --- Event Listeners & Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Password visibility toggle
            const togglePassword = document.getElementById('toggle-password');
            const passwordInput = document.getElementById('password');
            togglePassword.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                const icon = type === 'password' ? 'icon-eye-open' : 'icon-eye-closed';
                togglePassword.innerHTML = `<svg class="icon-svg"><use href="#${icon}"></use></svg>`;
            });
            
            // Set initial screen
            navigateTo('login-screen');
        });

    </script>
</body>
</html>
